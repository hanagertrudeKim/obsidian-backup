---
date: 2023.09.01
title: electron을 이용한 데스크탑 앱 개발
tags:
  - electron
  - typeScript
  - python
  - dicom
---

## 파이프 라인
1. 파이썬 or 파이썬 스크립트 돌릴 수 있는 아무 언어로 desktop application 만드는 방법 찾아보기
2. Form 형식의 GUI 만들어보기
3. Form submit 했을때 간단한 파이썬 스크립트가 돌아가고 csv 파일로 데이터 세이브되는 파이프라인 만들어보기

대략적인 흐름
- 의료 이미지 데이터 업로드
- form 채우기 -> form 제출  
- 앱에서 form 정보 바탕으로 의료 이미지 데이터 deidentification하는 스크립트 돌려서 데이터 준비
- deidentification 된 이미지 & 간단한 정보 적힌 csv 파일 다운로드

## 개발 도구 선택하기
1. main tool 정하기
	- [[Electron]]
		- 개인적 선택 이유
			- linux서버 기반으로 돌아가는 데스크탑 앱 필요
			- 파이썬 스크립트를 돌릴수있는 언어 선택
			- 웹스택만으로 빠르게 개발할수있음
- 2. 이외의 프레임워크
	- react : 바닐라 js 보다는 익숙한 개발을 위해 선택
	- typescript : 코드 퀄리티, 타입 안정성을 위해 사용
	- react router : 라우팅 라이브러리로 사용. but, 기존에 사용하던 `BrowserRouter`가 아닌 파일 시스템의 라우팅임으로 `HashRouter` 사용할 예정
	- Material UI : GUI의 빠른 개발과 퀄리티를 위해 ui 라이브러리 사용 + ts 호환 최고

---

## electron 과 dicom de-id Python script 연결하기
우선 내가 앞서 생각해야할것들을 정리해보았다.

1. python script에 필요한 값 준비하기
	- dicom directory path
2. elctron 환경에서 python script 돌리는 방법 (de-id script)

dicom directory path 는 main ipc 의 dialog 모듈을 이용하여서 얻을수있었다.
다만, 문제는 electron 환경에서 python script 를 돌리는 것에 대해 꽤 많은 제약조건들이 존재해 구현하기가 쉽지 않다는 것이다.

정말 며칠을 시도하고 롤백을 4번하고나니 방법에도 한계가 와서,  제대로 정리해서 그동안의 실패 원인들을 분석해봐야겠다는 생각이 들었다. (너무 이것저것 급하게 시도하는건 정말 안좋은 습관이다.)

#### electorn 환경에서 python 실행하기
여태까지 시도해본, 여러 시행착오들을 나열해보겠다.

1. python-shell 이용하기  ( ❌ ) 

`python-shell`을 이용하면, node.js 환경에서도 python 스크립트를 돌릴수있다고 한다.
 하지만, 내 스크립트에는 `pydicom`, `numpy` 등등의 많은 파이썬 라이브러리가 설치되어있고, `python-shell` 은 이를 불러와주지 못했다.

2. Flask 를 이용해 백엔드를 구축하고 api 로 배포하기 ( ❌ )

배포까지 어찌저찌 완성했으나, 결정적인 문제를 고려하지 못했다. 바로 보안 문제이다.
사용자의 로컬에 직접 접근하여 무언가를 작업하는것은 rest api로써는 굉장히 예민한 문제였다.  
api 를 배포하고 electron 내에서 api 요청을 한다면, 브라우저를 거친다. 브라우저에서는 사용자의 로컬에 직접적으로 접근하는것을 막는다.

정리 => [[Electron 과 Flask 서버 연결하기]]

> [!note]
> 보안 상의 이유로 사용자의 로컬에 접근할 수 있는 디렉토리가 있으면 안됩니다. Flask 애플리케이션은 기본적으로 서버 측에서 실행되며, 사용자의 로컬 파일 시스템에 직접적으로 접근할 수 있는 기능이 없습니다.

이를 강제적으로 풀수도있지만, 보안적으로 높아야하는 병원데이터를 다뤄야한다는 점에서 옳지 않은  방법이라고 생각했다.

- 추가적으로 포기하지못하고 시도해본것은
	- 사용자의 로컬에 접근하지않고 dicom 파일을 다운받아 서버상의 가상 디렉토리에 저장하고 de-id 작업을 거친다음에 사용자가 다운받을수있는 형태로 제공한다.

그렇지만, dicom 파일을 업로드하는것에서 프론트의 문제가 컸다.
파일을 업로드 할수있는 용량의 한계가 존재했고, 많은 dicom 파일들을 처리해야하는 부분에서는 큰 리스크였다. 따라서, api 를 이용하는것은 많이 제약이 따르므로 electron 내에서 해결할수있는 방법을 모색해야겠다고 생각했다. 

주구장창 설명이 길었다. (나의 잃어버린 시간에 대한 애도라고 생각한다)
정리하자면, electron 환경에서 de-id python 실행이 까다로운 이유는 다음과 같이 정리된다.

#### 실패 원인 분석 결과

- **배포된 데스크탑 어플리케이션에는 python이 없다는 것을 가정해야한다.**
- **de-id 파이썬 스크립트는 사용자의 로컬에 접근하여 폴더를 생성하고, output 결과물을 저장하기에, 해당 접근성과 보안을 고려해야한다.** 


<이후의 해결책 찾기>

1. 첫번째 시도 - zip 파일로 통신하기 (실패)
electorn에서 로컬에 접근하여 zip 파일로 복사한후 -> 서버쪽에 zip 파일 그대로 넘기기
deid 실행후, 접근 가능한 flask/static 에 저장하고 -> electron에서 /static 에 접근하여 로컬 저장

하지만 [[413]] 에러가 발생한다. 시도해본 결과 단일 dicom 폴더 하나에 압축 크기를 최대치로 설정하여 압축했는데도, 서버가 허용할수있는 파일 크기를 훌쩍 넘어버린다.
사실상 압축을 더 쪼개서 많이하고 서버에다가 보내는 방법도 생각해봤지만, 

2.  두번째 시도 - [[python 인터프리터와 라이브러리 포함하여 패키징]] <= 정리
 파이썬 인터프리터를 Electron 애플리케이션과 함께 패키징하여 배포하는 방법을 시도했으나, 인터프리터의 오류와 용량 문제가 커져서, 결국 다른 방법을 고안해야했다.

3. 세번째 시도 - PyQt 로 앱 구축하기 (성공)








