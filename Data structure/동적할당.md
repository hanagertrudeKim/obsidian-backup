## 동적 할당


### 프로그램 동작 원리
- 컴퓨터 구조
	- CPU, RAM(주기억장치), HDD(하드디스크/보조기억장치), OS(운영체제)
- 프로그램 실행 원리
	- 사용자는 OS를 통해 프로그램 실행 요청을 보낸다.
	- 하드디스크에 저장된 program 정보를 읽음 ->  RAM, 메모리의 프로그램 코드 영역에 올린다.
	- cpu는 program code를 읽음 -> 메모리를 관리하고 명령문을 실행함.
	-  프로그램 실행을 위한 동적 메모리 할당시 free store 영역을 사용
		- 아래로 확장한다.
	- system 작동을 위해 cpu가 임시 정보를 스택에 저장시 free store 영역을 사용
		- 위로 확장한다.
	- 만약, heap 과 stack 메모리를 많이 사용해 free store 영역이 없어지면 메모리 부족 상태가 됨.

![[Pasted image 20230211020924.png]]

### 메모리 영역별 특징
- program code 
	- 실행한 프로그램의 코드가 저장
- data
	- 전역변수
	- static 변수 
	- program 종료시까지 남아있는다
- heap
	- 동적 할당된 메모리 영역
	- C++ `new()` C언어 `malloc()`
	- C++ delete와 C언어 free 사용
	- 프로그래머가 할당, 해제
- stack 
	- 지역변수와 매개변수가 할당, 함수 종료시까지 자동 소멸된다.

### 동적 할당하는 이유
- 일시적으로 많은 메모리를 잡아야할때 사용함.
	- 프로그램을 실행하면 ram에 올라가서 돌게 되는데 ram의 메모리 자원은 한정적이다.
	-  프로세스 많이 필요한 상황일때,
		- 처음부터 끝까지 공간을 잡으면 메모리 낭비가 많이 일어난다.
		- 따라서 메모리를 필요한 상황에서만 잡고 다시 해지시키는 방법을 이용해야한다.
		- -> 결과적으로 메모리 공간을 효율적으로 이용할수있게된다.
		- == 이와 같은 것이 **동적할당**이다. 
- 함수 return 이후에도 메모리 할당이 살아있게 하고 싶은 경우
	- 지역 변수는 함수 종료시 같이 사라지기때문에
- 그때 그때 메모리를 요청하기 위해
	- 대표적인 예시로, `vector` 가 있다.

## 동적 할당 특징
- 꼭 쌍을 맞추어 사용 
	- 일부만 해제되는 문제 발생 가능
	-  malloc - free
	- new - delete
	- new[] - delete[]
- 메모리 해제후 포인터의 경우 `NULL` 로 초기화해 에러를 방지한다.